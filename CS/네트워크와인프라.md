## 네트워크와 인프라

### 로드 밸런싱

로드 밸런싱(Load Balancing)은 네트워크 트래픽을 여러 서버에 고르게 분산시켜 서버의 부하를 조절하고 시스템의 성능과 가용성을 높이는 기술이다. 이를 통해 하나의 서버에 과부하가 걸리는 것을 방지하고, 장애 발생시에도 시스템이 지속적으로 서비스할 수 있게한다

### 로드 밸런싱의 주요 기법

- **라운드 로빈(Round Robin)**:
    - **설명**: 각 서버에 순차적으로 요청을 분배한다
    - **장점**: 구현이 간단하고, 서버들이 비슷한 성능을 가진 경우에 적합하다
    - **단점**: 서버의 부하나 성능 차이를 고려하지 않기 때문에 비효율적인 분배가 발생할 수 있다
- **가중치 라운드 로빈(Weighted Round Robin)**:
    - **설명**: 서버에 가중치를 부여하고, 가중치에 따라 더 많은 요청을 특정 서버로 분배한다
    - **장점**: 서버 성능에 따라 트래픽을 분배할 수 있어 효율적이다
    - **단점**: 가중치 설정이 잘못되면 오히려 부하가 특정 서버에 집중될 수 있다
- **IP 해시(IP Hash)**:
    - **설명**: 클라이언트의 IP 주소를 해시하여 특정 서버에 요청을 보낸다
    - **장점**: 특정 클라이언트가 항상 동일한 서버에 연결되도록 하여 세션 유지가 용이하다
    - **단점**: 서버가 추가되거나 제거될 때 해시가 변경되어 세션 유지가 어려울 수 있다
- **최소 연결(Least Connections)**:
    - **설명**: 현재 가장 적은 수의 연결을 처리하고 있는 서버에 요청을 보낸다
    - **장점**: 서버 부하를 동적으로 반영하여 균형 잡힌 트래픽 분배가 가능하다
    - **단점**: 서버 상태를 지속적으로 모니터링해야 하므로 구현이 복잡할 수 있다

### Java기반 웹 애플리케이션에서의 로드 밸런서

Java 기반 웹 애플리케이션에서는 nginx나 HAProxy같은 로드밸런서를 사용하여 서버풀을 구성할 수 있다. 이를 통해 한 서버가 장애를 겪더라도 로드밸런서가 자동으로 다른 서버로 트래픽을 우회시켜 서비스를 지속할 수 있다.

각 서버간 세션 공유를 위해 Redis나 Sticky Session등의 외부 세션저장소를 활용할 수도 있다

### Nginx 예제

```java
http {
    upstream backend_servers {
        server backend1.example.com;
        server backend2.example.com;
        # 라운드 로빈이 기본 방식. 순차적으로 서버에 요청을 분배한다.
    }

    server {
        listen 80;
        
        location / {
            proxy_pass http://backend_servers;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}

```

### 설정 파일 설명

1. **`upstream` 블록**: `backend_servers`라는 이름으로 두 개의 백엔드 서버를 정의한다. Nginx는 여기에 정의된 서버들 간에 요청을 라운드 로빈 방식으로 분배한다.
2. **`server` 블록**: 클라이언트로부터의 요청을 수신하는 서버 블록이다. 기본적으로 80번 포트를 통해 요청을 수신하고, 이 요청을 `upstream`에서 정의한 백엔드 서버로 전달한다.
3. **`proxy_pass` 지시어**: 클라이언트 요청을 지정된 백엔드 서버 그룹으로 전달한다
4. **헤더 설정**: `proxy_set_header` 지시어를 사용하여 클라이언트의 IP 주소와 같은 정보를 백엔드 서버에 전달한다.