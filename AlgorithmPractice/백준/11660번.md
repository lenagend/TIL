# 11660번

# 구간 합 구하기 5

| 시간 제한 | 메모리 제한 | 제출 | 정답 | 맞힌 사람 | 정답 비율 |
| --- | --- | --- | --- | --- | --- |
| 1 초 | 256 MB | 77022 | 35072 | 26062 | 43.816% |

## 문제

N×N개의 수가 N×N 크기의 표에 채워져 있다. (x1, y1)부터 (x2, y2)까지 합을 구하는 프로그램을 작성하시오. (x, y)는 x행 y열을 의미한다.

예를 들어, N = 4이고, 표가 아래와 같이 채워져 있는 경우를 살펴보자.

| 1 | 2 | 3 | 4 |
| --- | --- | --- | --- |
| 2 | 3 | 4 | 5 |
| 3 | 4 | 5 | 6 |
| 4 | 5 | 6 | 7 |

여기서 (2, 2)부터 (3, 4)까지 합을 구하면 3+4+5+4+5+6 = 27이고, (4, 4)부터 (4, 4)까지 합을 구하면 7이다.

표에 채워져 있는 수와 합을 구하는 연산이 주어졌을 때, 이를 처리하는 프로그램을 작성하시오.

## 입력

첫째 줄에 표의 크기 N과 합을 구해야 하는 횟수 M이 주어진다. (1 ≤ N ≤ 1024, 1 ≤ M ≤ 100,000) 둘째 줄부터 N개의 줄에는 표에 채워져 있는 수가 1행부터 차례대로 주어진다. 다음 M개의 줄에는 네 개의 정수 x1, y1, x2, y2 가 주어지며, (x1, y1)부터 (x2, y2)의 합을 구해 출력해야 한다. 표에 채워져 있는 수는 1,000보다 작거나 같은 자연수이다. (x1 ≤ x2, y1 ≤ y2)

## 출력

총 M줄에 걸쳐 (x1, y1)부터 (x2, y2)까지 합을 구해 출력한다.

## 예제 입력 1

```
4 3
1 2 3 4
2 3 4 5
3 4 5 6
4 5 6 7
2 2 3 4
3 4 3 4
1 1 4 4

```

## 예제 출력 1

```
27
6
64

```

## 예제 입력 2

```
2 4
1 2
3 4
1 1 1 1
1 2 1 2
2 1 2 1
2 2 2 2

```

## 예제 출력 2

```
1
2
3
4
```

## 의사코드

N과 M을 입력받아 정수형으로 저장한다

숫자가 들어갈 2차원 배열 arr를 선언한다

합이 들어갈 2차원 배열 prefixSum를 선언한다

i, j를 이용해 반복문으로  arr를 채운다

(모름)

M만큼 반복해 숫자들을 입력받고

합집합으로 영역의 셈을 구한다

---

### 이후에는 못풀었다.

2차원 배열의 합집합 구하는게 머릿속으로 정리되지 않았다.

합집합을 채우는 코드는

```java
[i][j] = arr[i][j] + prefixSum[i - 1][j] + 
prefixSum[i][j - 1] - prefixSum[i - 1][j - 1];

```

chatGpt의 설명

이 식은 **2차원 누적 합**을 구하는 공식입니다. 각 항목이 무엇을 의미하는지 자세히 살펴보겠습니다:

- **`arr[i][j]`**: `(i, j)` 위치의 원래 배열 값입니다.
- **`prefixSum[i-1][j]`**: `(1,1)`에서 `(i-1,j)`까지의 누적 합입니다. 즉, `(i,j)` 바로 위쪽 영역의 합입니다.
- **`prefixSum[i][j-1]`**: `(1,1)`에서 `(i,j-1)`까지의 누적 합입니다. 즉, `(i,j)` 바로 왼쪽 영역의 합입니다.
- **`prefixSum[i-1][j-1]`**: `(1,1)`에서 `(i-1,j-1)`까지의 누적 합입니다. 즉, 위와 왼쪽 부분이 겹치는 영역의 합입니다.

### **왜 빼는가?**

코드에서 중요한 부분은 `prefixSum[i-1][j-1]`을 빼는 부분입니다.

- `prefixSum[i-1][j]`와 `prefixSum[i][j-1]`을 더하면서 `(1,1)`에서 `(i-1,j)`까지의 합과 `(1,1)`에서 `(i,j-1)`까지의 합이 더해집니다. 이 두 부분이 만나는 `(1,1)`에서 `(i-1,j-1)` 부분이 두 번 더해지기 때문에, 이를 한 번 빼줌으로써 중복 계산을 제거합니다.

### 구간 합을 구하는 방법

구간 `(x1, y1)`에서 `(x2, y2)`까지의 합을 계산하려면, 다음을 고려해야 합니다:

- **전체 영역 `prefixSum[x2][y2]`**: (1,1)부터 (x2,y2)까지의 모든 요소의 합입니다. 이 값은 구간 `(x1,y1)`부터 `(x2,y2)`까지의 합을 포함하지만, 우리가 구하려는 직사각형 바깥의 요소들도 포함하고 있습니다.
- **위쪽 잘라내기 `prefixSum[x1-1][y2]`**: (1,1)부터 (x1-1,y2)까지의 모든 요소의 합입니다. 이 값은 우리가 구하려는 직사각형 영역의 위쪽 부분을 제거하기 위해 사용됩니다.
- **왼쪽 잘라내기 `prefixSum[x2][y1-1]`**: (1,1)부터 (x2,y1-1)까지의 모든 요소의 합입니다. 이 값은 우리가 구하려는 직사각형 영역의 왼쪽 부분을 제거하기 위해 사용됩니다.
- **중복된 부분 추가 `prefixSum[x1-1][y1-1]`**: (1,1)부터 (x1-1,y1-1)까지의 모든 요소의 합입니다. 위쪽과 왼쪽 영역을 제거하면서 두 번 빼진 중복된 영역을 다시 더해줍니다.

```java
int result = prefixSum[x2][y2] 
           - prefixSum[x1 - 1][y2] 
           - prefixSum[x2][y1 - 1] 
           + prefixSum[x1 - 1][y1 - 1];

```

====

내일 안보고 한번 더 풀어보기